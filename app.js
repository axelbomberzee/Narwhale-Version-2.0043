!function(t){function e(r){if(i[r])return i[r].exports;var o=i[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";i(1);var r=i(5);window.StatusBar&&window.StatusBar.styleLightContent(),window.game=new r.Game},function(t,e){},,,,function(t,e,i){"use strict";var r=i(6),o=i(8),s=i(14),a=i(15),n=i(9),h=i(7),l=i(10),c=i(12),d=i(16),p=i(17),u=i(18),y=i(19),m=i(13),f=i(20),v;!function(t){t[t.Drag=0]="Drag",t[t.JoyStick=1]="JoyStick",t[t.Mirror=2]="Mirror"}(v||(v={}));var g=function(){function t(e){var i=this;this.allNets={},this.nowRoomOrder=0,this.screen={width:window.innerWidth,height:window.innerHeight},this.controlMode=v.Drag,this.useTest=!1,this.serverGroups=this.useTest?{Testing:{A:"ws://"+window.location.hostname+":443"}}:SERVER_LIST,this.lastTargetUpdateTime=0,this.isMobile=!1,this.wasMoved=!1,this.loginAccumTime=0,this.shrinkRatio=1,this.extraShrinkRatio=1,this.gameStarted=!1,this.rtt=.2,this.lastSetElementTime=0,this.isDead=!0,this.throtling=0,this.meanThrotling=0,this.player={id:0,x:0,y:0},this.clientElements={},this.serverElements={},this.elements={},this.target={x:.001,y:0,changed:!1},this.fps=0,this.fpstimer=0,this.lastTick=0,this.targetviewscale=1,this.waitChooseCount=0,this.waitDuration=1e3,this.name="",this.rooms={},this.nowlevel=1,this.dashable=!1,this.tryWrongDash=!1,this.lastRoomIsBest=!1,this.displayNarwhal=new l.ChainElement,this.maxLeaderDisplay=5,this.flashAvailable=!1,this.indicatorX=0,this.indicatorY=0,this.lastServerListUpdateTime=window.performance.now(),this.initJoyX=0,this.initJoyY=0,this.atkTextScale=1,this.defTextScale=1,this.tutTextScale=1,this.joystickScale=1,this.joyTextColorScale=.1,this.lastJoyX=0,this.lastJoyY=0,this.touchActivated=!1,this.colorH=0,this.colorS=0,this.colorL=0,this.hasJoined=!1,this.skincode=0,this.doAutoLogin=!1,this.deathTimes=0,this.adPlayed=!1,this.responseReceived=!1,this.padActivated=!1,this.cannotRetreat=!1,this.cannotDash=!1,this.gameDuration=0,this.timeSlowFactor=1,this.dragLineAlpha=1,this.dragLineAlphaDecay=0,this.dragLineWidth=10,this.dragTutorialDecay=0,this.joystickAlpha=0,this.joystickAlphaDecay=0,this.joyTutorialDecay=0,this.swearFilter="buttholeAslutAbitchApenisAanalAanusAshitAassholeAfuckAbitchAniggerAxhamsterAcockAcuntAdickApornAhornyArape",e||(e={}),this.options=o.extend(t.defaultOptions,e),window.onload=function(){i.launch()},window.onmessage=function(t){"setmobile"===t.data&&i.setIsMobile(!0)},"true"===localStorage.getItem("isMobile")&&(this.isMobile=!0)}return t.prototype.ajax=function(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&200==i.status&&e(i.responseText)},i.open("GET",t,!0),i.send()},t.prototype.detectFlash=function(){try{var t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");t&&(this.flashAvailable=!0)}catch(e){var i=navigator.mimeTypes["application/x-shockwave-flash"];void 0!=i&&(this.flashAvailable=!0)}},t.prototype.initSessionInfo=function(){if(window.sessionStorage.getItem("gameDuration")&&(this.gameDuration=parseFloat(window.sessionStorage.getItem("gameDuration"))),window.sessionStorage.getItem("deathTimes")&&(this.deathTimes=parseFloat(window.sessionStorage.getItem("deathTimes"))),window.localStorage.getItem("adPlayed")){var t=parseInt(window.localStorage.getItem("adPlayed")),e=(new Date).getTime();.001*(e-t)/60/60<1?this.adPlayed=!0:(this.adPlayed=!1,window.localStorage.removeItem("adPlayed"))}},t.prototype.setIsMobile=function(t){t!==this.isMobile&&(this.isMobile=t,this.updateMobileUIVisibility(),localStorage.setItem("isMobile",t.toString()))},t.prototype.launch=function(){this.init(),this.loop()},t.prototype.setupDisplayNarwhal=function(){var t=this.displayNarwhal;t.parts=[],t.id=0,t.color=16777215,t.name="",t.size=36,t.alpha=0,t.maxDash=0,t.curDash=0,t.overDash=0,t.tuskRatio=.5,t.decoration=0,t.breakPoint=11;var e=new l.ChainElementUnit;e.x=0,e.y=0,e.vx=0,e.vy=0,e.vt=0,e.rot=Math.PI,t.parts.push(e),t.setSkinCode(0);for(var i=10,r=1;r<i+1;++r){var o=new l.ChainElementUnit;o.x=0,o.y=0,o.vt=0,o.vx=0,o.vy=0,o.rot=Math.random(),t.parts.push(o)}},t.prototype.handleLevelUp=function(t,e,i){var r=this;if(i<e.length){var o=new l.TextElement(this.translateUpgradeName(e[i]),2);o.vy=-150,o.y=-100,this.clientElements[Math.random()]=o,this.lvnum.innerText=(this.nowlevel-(e.length-i-1)).toString(),this.isDead||setTimeout(function(){r.handleLevelUp(t,e,i+1)},t)}else this.lvnum.className=""},t.prototype.translateUpgradeName=function(t){switch(t){case 0:return"Tusk Upgraded!";case 1:return"Speed Up!";case 2:return"Turn Rate Up!";case 3:return"Dash Speed Up!";case 4:return"Stamina Regen Up!";case 5:return"Stamina Up!"}return"Unknown"},t.prototype.refreshRooms=function(){var t=new Array;for(var e in this.rooms)t.push(this.rooms[e]);t.sort(function(t,e){return t.roomOrder!==e.roomOrder?t.roomOrder-e.roomOrder:t.uid.localeCompare(e.uid)});var i,r="";for(var o in t){var s=t[o];i&&i===s.net.tag||(r+="<option disabled> ----- "+s.net.tag+" ----- </option>",i=s.net.tag),r+='<option value= "'+s.net.tag+s.id+'" '+(this.lastRoom==s.uid?"selected":"")+">"+s.name+" ("+s.playerCount+")</option>"}this.roomsText.innerHTML=r,this.roomsText.disabled=!1},t.prototype.initWebSockets=function(){for(var t in this.serverGroups){var e=this.serverGroups[t];for(var i in e){var o=e[i],s=new r.Network(o,new u.ConcretePacketFactory);this.allNets[o]=s,s.area=t,s.tag=i}}},t.prototype.queryServer=function(){var t=this,e=function(e){e.emit(n.PacketID.GetLobbies),t.area?e.area!==t.area&&e.close():t.changeArea(e.area)};for(var i in this.allNets){var r=this.allNets[i];void 0!==r&&(r.open(),r.onConnect=e)}},t.prototype.checkShared=function(){this.showCustomizer(null!==localStorage.getItem("shared"))},t.prototype.addClass=function(t,e){t.classList?t.classList.add(e):t.className+=" "+e},t.prototype.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")},t.prototype.performScoreUpdate=function(t,e){var i=this;setTimeout(function(){i.addClass(t,"flipper"),setTimeout(function(){t.innerHTML=e.toString()},500),setTimeout(function(){i.removeClass(t,"flipper")},1e3)},750)},t.prototype.setupNetEvent=function(t){var e=this;t.on(n.PacketID.TeamInfo,function(t){if(t.isGameFinished){var i=t.leftTeamScore>t.rightTeamScore,r=i?"Orange":"Blue",o=i?"black":"white",s=i?16755200:1662975,a=r+" Team Wins!";e.centerNotifier.style.display="block",e.centerNotifier.innerHTML=a,e.centerNotifier.style.color=o;var n=e.clientElements[Math.random()]=new l.FullScreenElement;n.color=s,setTimeout(function(){e.centerNotifier.style.display="none"},2e3)}else if(t.isRoundDone){var h=t.leftTeamScore.toString()==e.leftTeamScore.innerText,c=h?e.rightTeamScore:e.leftTeamScore,d=h?t.rightTeamScore:t.leftTeamScore;e.performScoreUpdate(c,d)}else e.performScoreUpdate(e.rightTeamScore,t.rightTeamScore),e.performScoreUpdate(e.leftTeamScore,t.leftTeamScore)}),t.on(n.PacketID.LeaderBoard,function(t){e.teamBox.style.display=e.isTeamPlay?"block":"none",e.leaderBoxTitle.style.display=e.maxLeaderDisplay>0?"block":"none",e.leaderBoxTitle.style.marginBottom=e.isTeamPlay?"10px":"0px";var i=new Array,r=new Array,o=new Array;for(var s in t.record){var a=t.record[s];i.push(a.level.toString()),r.push(a.name.substring(0,25)),o.push("#"+(parseInt(s)+1))}e.leaderNames.innerHTML="",e.leaderLevels.innerHTML="",e.leaderPlaces.innerHTML="";for(var s=0;s<Math.min(r.length,e.maxLeaderDisplay);++s){var n=document.createElement("p"),h=document.createElement("p"),l=document.createElement("p");n.appendChild(document.createTextNode(i[s]));var c=r[s];""===c&&(c="Lazy Narwhale"),h.appendChild(document.createTextNode(c)),l.appendChild(document.createTextNode(o[s])),e.leaderLevels.appendChild(n),e.leaderNames.appendChild(h),e.leaderPlaces.appendChild(l)}}),t.on(n.PacketID.PlayerInfo,function(t){e.nowlevel=t.level,setTimeout(function(){e.handleLevelUp(500,t.upgrade,0)},50)}),t.on(n.PacketID.Ping,function(i){e.rtt=.5*e.rtt+.001*(window.performance.now()-i.now)*.5,window.setTimeout(function(){t.isReady&&t.emit(new h.PingPacket(window.performance.now()))},15e3)}),t.on(n.PacketID.GetLobbies,function(i){for(var r=0,o=i.data;r<o.length;r++){var s=o[r];s.net=t,s.uid=s.net.tag+s.id.toString(),s.roomOrder=e.rooms[s.uid].roomOrder,e.rooms[s.uid]=s}e.refreshRooms()}),t.on(n.PacketID.Start,function(t){e.responseReceived=!0,e.gameStarted=!0,e.player.id=t.uid}),t.on(n.PacketID.RIP,function(t){e.isDead=!0,e.deathTimes+=1,window.sessionStorage.setItem("deathTimes",e.deathTimes.toString()),setTimeout(function(){e.tryUpdateServerList(),e.setIntroUIVisible(!0),e.setUIVisible(!1)},2500)}),t.on(n.PacketID.TransientElement,function(t){switch(t.type){case f.TransientObjectID.SmokeExplosion:e.textureMan.getNamedTexture("explosion");var i=e.clientElements[Math.random()]=new l.SmokeExplosionElement;r=t.getPos(e.fieldOptions.width,e.fieldOptions.height),i.x=r[0],i.y=r[1]}var r}),t.on(n.PacketID.SetElements,function(t){e.net.immediateResponse=!1,e.timeSlowFactor=t.slowFactor,e.hasJoined=!0;var i=t.time-e.lastSetElementTime;e.lastSetElementTime=t.time,e.meanThrotling=.9*e.meanThrotling+.1*e.net.throtling,e.indicatorX=2*t.indicatorX*e.fieldOptions.width-e.fieldOptions.width/2,e.indicatorY=2*t.indicatorY*e.fieldOptions.height-e.fieldOptions.height/2;for(var r={},o=0,s=t.elements;o<s.length;o++){var a=s[o];e.serverElements[a.id]&&a.smoothFrom&&a.smoothFrom(e.serverElements[a.id],i),r[a.id]=a}e.serverElements=r})},t.prototype.tryUpdateServerList=function(){var t=this;if(!this.useTest){var e=window.performance.now(),i=e-this.lastServerListUpdateTime;i/1e3<this.options.serverUpdatePeriodInSecs||(this.lastServerListUpdateTime=e,this.ajax("http://l92.168.18.2/howareyou.js?version=1.1",function(e){eval(e),t.serverGroups=SERVER_LIST}))}},t.prototype.setupGraphics=function(){this.renderer=PIXI.autoDetectRenderer(this.screen.width,this.screen.height,{view:this.canvas,antialiasing:!0,resolution:1}),this.layers=new p.RenderLayers,this.smalllayers=new p.RenderLayers,this.textureMan=new y.TextureManager(this.renderer),this.renderFactory=new d.RenderFactory(this.textureMan.circleTexture),this.setupDisplayNarwhal()},t.prototype.handleResize=function(t){void 0===t&&(t=!0);this.screen.width,this.screen.height;t?(this.screen.width=this.canvas.clientWidth*window.devicePixelRatio,this.screen.height=this.canvas.clientHeight*window.devicePixelRatio):(this.screen.width=window.innerWidth*window.devicePixelRatio,this.screen.height=window.innerHeight*window.devicePixelRatio);var e=this.options.defaultWidth,i=this.options.defaultHeight;this.screen.width<this.screen.height&&(e=this.options.defaultHeight,i=this.options.defaultWidth);var r=e/i,o=this.screen.width/this.screen.height;return o>r?this.shrinkRatio=this.screen.width/e*this.options.viewScale:this.shrinkRatio=this.screen.height/i*this.options.viewScale,this.grid&&this.grid.render(this.layers.gridDraw,this.shrinkRatio*this.extraShrinkRatio),!0},t.prototype.handleMove=function(t,e){if(this.gameStarted&&!this.spawnbox.offsetParent){var i=2;this.isDead&&(i=.2);var r=Math.min(window.innerWidth,window.innerHeight),o=(t-window.innerWidth/2)/r*2,s=(e-window.innerHeight/2)/r*2,a=Math.sqrt(o*o+s*s);if(!(a<1e-4||a!==a)){var n=Math.min(1,a);this.target.x=o/a*n*i,this.target.y=s/a*n*i,this.target.changed=!0}}},t.prototype.tryRetreat=function(){this.spawnbox.offsetParent||this.isDead||(this.dashable?this.net.emit(new h.RetreatPacket((-this.target.x),(-this.target.y))):this.tryWrongDash=!0)},t.prototype.tryDash=function(){if(!this.spawnbox.offsetParent&&!this.isDead)return this.dashable?(this.dragTutorialDecay=.05,this.net.emit(new h.SplitUpPacket(this.target.x,this.target.y)),!0):(this.tryWrongDash=!0,!1)},t.prototype.popWindow=function(t,e,i){var r=screen.width/2-e/2,o=screen.height/2-i/2;this.popper=window.open(t,"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+e+", height="+i+", top="+o+", left="+r)},t.prototype.showCustomizer=function(t){void 0===t&&(t=!0),document.getElementById("customTab").style.display=t?"block":"none",document.getElementById("shareBox").style.display=t?"none":"block"},t.prototype.testShared=function(){var t=this,e=document.getElementById("shareBox");!this.isMobile&&e&&"none"!=window.getComputedStyle(e).display||(localStorage.setItem("shared","true"),this.showCustomizer(),this.popper=void 0),this.popper&&setTimeout(function(){t.popper.closed?(localStorage.setItem("shared","true"),t.showCustomizer(),t.popper=void 0):t.testShared()},1e3)},t.prototype.handleJoystickStart=function(t,e){var i=this;void 0===e&&(e=!1);var r=t.changedTouches[0].clientX,o=t.changedTouches[0].clientY,s=window.innerWidth/2;window.innerHeight/2;if(e||r<s)this.joystickAlpha<=.385?(this.initJoyX=this.lastJoyX=r,this.initJoyY=this.lastJoyY=o):e||this.handleJoystickMove(t,e),this.joystickAlpha=1,this.joystickAlphaDecay=0;else{var a=!0,n=window.innerWidth-r,h=window.innerHeight-o,l=n*this.options.defaultJoySplitRatio>h,c=l?this.tryDash():this.tryRetreat(),d=c?1.8:1.1;l?this.atkTextScale=d:this.defTextScale=d,c&&(this.joyTutorialDecay=.05)}if(e){var a=!0;if(this.touchTimeoutRec){var p=this.tryDash();p&&(clearTimeout(this.touchTimeoutRec),a=!1,this.joyTutorialDecay=.05,this.joystickScale=1.5)}a&&(clearTimeout(this.touchTimeoutRec),this.touchTimeoutRec=setTimeout(function(){i.touchTimeoutRec=null},250))}else if(r<s){if(this.touchTimeoutRec&&this.joyTutorialText){this.joyTutorialDecay=0;var u="Tap for Action ---->";this.joyTutorialText.text!==u&&(this.joyTutorialText.text=u,this.joyTutorialText.dirty=!0),this.joyTutorialText.dirty=!0,this.joyTutorialText.alpha=.15,this.atkTextScale=1.2,this.defTextScale=1.2,this.tutTextScale=1.5,this.joyTextColorScale=1}this.touchTimeoutRec&&clearTimeout(this.touchTimeoutRec),this.touchTimeoutRec=setTimeout(function(){i.touchTimeoutRec=null},250)}},t.prototype.handleDragStart=function(t){var e=this;this.dragLineAlphaDecay=0,this.dragLineAlpha=1,this.handleMove(t.changedTouches[0].clientX,t.changedTouches[0].clientY);var i=!0;if(this.touchTimeoutRec){var r=this.tryDash();r&&(clearTimeout(this.touchTimeoutRec),this.dragLineWidth=65,this.touchTimeoutRec=null,i=!1)}i&&(this.touchTimeoutRec&&clearTimeout(this.touchTimeoutRec),this.touchTimeoutRec=setTimeout(function(){e.touchTimeoutRec=null},333))},t.prototype.handleJoystickMove=function(t,e){void 0===e&&(e=!1);var i=t.changedTouches[0].clientX,r=t.changedTouches[0].clientY,o=window.innerWidth/2,s=window.innerHeight/2,a=30;if(e||i<o){if(this.lastJoyX=t.targetTouches[0].clientX,this.lastJoyY=t.targetTouches[0].clientY,Math.abs(this.lastJoyX-this.initJoyX)+Math.abs(this.lastJoyY-this.initJoyY)<5)return;this.handleMove((i-this.initJoyX)/a*o+o,(r-this.initJoyY)/a*s+s)}},t.prototype.handleDragMove=function(t){this.dragLineAlpha=1,this.handleMove(t.targetTouches[0].clientX,t.targetTouches[0].clientY)},t.prototype.handleDragEnd=function(t){t.touches.length>0||(this.dragLineAlphaDecay=.1)},t.prototype.handleJoyStickEnd=function(t){for(var e in t.touches)if(t.touches[e].clientX<window.innerWidth/2)return;this.joystickAlphaDecay=.1},t.prototype.setupCanvasEvent=function(){var t=this;this.canvas.addEventListener("touchend",function(e){switch(t.controlMode){case v.JoyStick:t.handleJoyStickEnd(e);break;case v.Mirror:t.handleJoyStickEnd(e);break;case v.Drag:t.handleDragEnd(e)}}),this.canvas.addEventListener("wheel",function(e){t.targetviewscale-=e.deltaY/2e3,t.targetviewscale=Math.min(.8/.69,t.targetviewscale),t.targetviewscale=Math.max(1,t.targetviewscale)}),this.canvas.addEventListener("touchstart",function(e){switch(t.activateTouch(),t.loginAccumTime=0,t.net&&t.net.isClosed&&t.reconnect(),t.controlMode){case v.Mirror:t.handleJoystickStart(e,!0);break;case v.JoyStick:t.handleJoystickStart(e);break;case v.Drag:t.handleDragStart(e)}}),this.canvas.addEventListener("touchmove",function(e){switch(t.loginAccumTime=0,t.net&&t.net.isClosed&&t.reconnect(),t.controlMode){case v.Mirror:t.handleJoystickMove(e,!0);break;case v.JoyStick:t.handleJoystickMove(e);break;case v.Drag:t.handleDragMove(e)}}),this.canvas.addEventListener("click",function(e){t.tryDash()}),this.canvas.oncontextmenu=function(e){return t.tryRetreat(),!1},this.canvas.addEventListener("mousemove",function(e){t.activateTouch(!1),t.loginAccumTime=0,t.net&&t.net.isClosed&&t.reconnect(),t.handleMove(e.clientX,e.clientY)}),this.resizeHandleRoutine()},t.prototype.cookieParse=function(){localStorage.getItem("control")?this.toggleControl(!0,parseInt(localStorage.getItem("control"))):this.toggleControl(!0,v.JoyStick),localStorage.getItem("name")&&(this.nameText.value=localStorage.getItem("name")),this.checkShared()},t.prototype.init=function(){var t=this;this.detectFlash(),this.chooseRandomColor(),this.assignElements(),this.setupCanvasEvent(),this.setupWindowEvent(),this.setupOtherEvent(),this.initWebSockets(),this.queryServer(),this.setupGraphics(),this.setUIVisible(!1),this.initSessionInfo(),this.cookieParse(),this.updateMobileUIVisibility(),setTimeout(function(){t.testShared()},1e3)},t.prototype.updateMobileUIVisibility=function(){var t=document.getElementById("footerWrapper");t&&(t.style.display=this.isMobile?"none":"block");var e=document.getElementById("facebookShareBox");e&&(e.style.display=this.isMobile?"none":"block");var i=document.getElementById("googlePlayButton");i&&(i.style.display=this.isMobile?"none":"block"),this.activateTouch(this.isMobile)},t.prototype.setupOtherEvent=function(){var t=this;this.nameText.onblur=function(){setTimeout(function(){t.resizeHandleRoutine()},500)}},t.prototype.refreshAreas=function(){var t="";for(var e in this.serverGroups)t+='<option value = "'+e+'"'+(this.area===e?"selected":"")+">"+e+"</option>";this.areaText.innerHTML=t},t.prototype.setIntroUIVisible=function(t){var e=document.querySelectorAll(".outgameUI");for(var i in e){var r=e[i];r.style&&(r.style.display=t?"block":"none")}this.touchActivated?(this.refreshButton.style.display="block",this.controlBox.style.display="block",this.controlBox.style.opacity=t?"1.0":"0.2"):(this.controlBox.style.display="none",this.refreshButton.style.display="none")},t.prototype.setUIVisible=function(t){var e=document.querySelectorAll(".ingameUI");for(var i in e){var r=e[i];r.style&&(r.style.display=t?"block":"none")}},t.prototype.chooseBestRoom=function(){var t,e,i,r=2,o=999;for(var s in this.rooms){i=s;var a=this.rooms[s];if(a.options.isPriority){var n=1-a.playerCount/a.options.desirablePlayerNum,h=-n;n>=0?r>n&&(r=n,t=s):o>h&&(o=h,e=s)}}return t?[t,!0]:e?[e,!1]:[i,!1]},t.prototype.changeArea=function(t){var e=this;if(this.area!==t){var i=function(t){t.emit(n.PacketID.GetLobbies)},r=function(t,i){for(var r=0,o=0,s=t.data;o<s.length;o++){var a=s[o];r+=a.playerCount}if(!(r>150)){for(var n=0,h=t.data;n<h.length;n++){var a=h[n];a.net=i,a.uid=a.net.tag+a.id.toString(),a.roomOrder=e.nowRoomOrder,e.rooms[a.uid]=a}if(++e.nowRoomOrder,e.lastRoom&&e.lastRoomIsBest)i.close();else{var l=e.chooseBestRoom(),c=l[0],d=l[1];!e.lastRoom||d?(e.lastRoomIsBest=d,e.join(c)):i.close()}e.refreshRooms(),e.refreshAreas()}},o=this.area;if(o){var s=this.serverGroups[o];for(var a in s){var h=s[a],l=this.allNets[h];void 0!==l&&l.close()}}this.area=t,this.nowRoomOrder=0,this.rooms={},this.roomsText.innerHTML="<option disabled selected>Connecting...</option>",this.roomsText.disabled=!0,this.lastRoom=void 0;var c=this.serverGroups[this.area];for(var a in c){var h=c[a],l=this.allNets[h];void 0!==l&&(l.open(),l.onConnect=i,l.on(n.PacketID.GetLobbies,r))}}},t.prototype.updateSelectedDisplay=function(t){for(var e in this.roomsText.children){var i=this.roomsText.children[e];if(i.value==t){var r=parseInt(e);this.roomsText.selectedIndex=r;break}}},t.prototype.toggleControl=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e=void 0),t||this.controlBox.getBoundingClientRect().left>-5){e||(e=(this.controlMode+1)%3),this.controlMode=e;var i="";switch(this.controlMode){case v.Drag:i="CONTROL:&nbsp;&nbsp;DRAG";break;case v.JoyStick:i="CONTROL:&nbsp;&nbsp;JOYSTICK";break;case v.Mirror:i="CONTROL:&nbsp;&nbsp;MIRROR"}localStorage.setItem("control",this.controlMode.toString()),this.controlText.innerHTML=i}this.clearJoyStickTutorial(),this.clearDragTutorial()},t.prototype.tryRefresh=function(){var t=confirm("Do you want to refresh the game?");t&&window.location.reload()},t.prototype.assignElements=function(){this.centerNotifier=document.getElementById("centerNotifier"),this.fullscreenDisplayer=document.getElementById("fullscreenDisplayer"),this.leftTeamScore=document.getElementById("leftscore"),this.rightTeamScore=document.getElementById("rightscore"),this.leaderBoxTitle=document.getElementById("leaderboxtitle"),this.teamBox=document.getElementById("teambox"),this.controlBox=document.getElementById("controlBox"),this.refreshButton=document.getElementById("refreshButton"),this.controlText=document.getElementById("controlText"),this.footer=document.getElementsByTagName("FOOTER")[0],this.areaText=document.getElementById("areas"),this.canvas=document.getElementById("cvs"),this.statusText=document.getElementById("status"),this.roomsText=document.getElementById("rooms"),this.nameText=document.getElementById("playerNameInput"),this.spawnbox=document.getElementById("spawnbox"),this.lvnum=document.getElementById("lvnum"),this.startButton=document.getElementById("startButton"),this.customizer=document.getElementById("sideBoxHidden"),this.levelText=document.getElementById("infobox"),this.leaderNames=document.getElementById("namerec"),this.leaderLevels=document.getElementById("levelrec"),this.leaderPlaces=document.getElementById("champrec"),this.leaderBoard=document.getElementById("leaderbox")},t.prototype.activateTouch=function(t){void 0===t&&(t=!0),this.touchActivated=t,this.controlBox.style.display=t?"block":"none",this.refreshButton.style.display=t?"block":"none"},t.prototype.resizeHandleRoutine=function(){var t=this.handleResize(!1);t&&this.renderer&&this.renderer.resize(this.screen.width,this.screen.height)},t.prototype.setupWindowEvent=function(){var t=this;window.onresize=function(){t.resizeHandleRoutine(),window.setTimeout(function(){t.resizeHandleRoutine()},250)},window.ontouchstart=function(){t.activateTouch(),t.net.isClosed&&t.reconnect()},window.addEventListener("keydown",function(e){switch(e.keyCode){case 32:case 13:case 81:case 90:t.tryDash();break;case 18:case 16:case 87:t.tryRetreat()}})},t.prototype.join=function(t){var e=this;if(this.loginAccumTime=0,this.net&&!this.net.isClosed){if(t==this.lastRoom)return;this.net.isReady&&this.net.emit(n.PacketID.Leave)}switch(this.fieldOptions=this.rooms[t].options,this.fieldOptions.fieldType){case m.FieldType.Normal:this.grid=new s.GridDraw(this.fieldOptions,this.options.grid);break;case m.FieldType.Soccer:this.grid=new a.FieldDraw(this.fieldOptions,this.options.grid)}this.grid.render(this.layers.gridDraw,this.shrinkRatio*this.extraShrinkRatio),this.net!=this.rooms[t].net&&(this.net&&this.net.close(),this.net=this.rooms[t].net,this.setupNetEvent(this.net)),this.net.isClosed&&this.net.open(),this.net.doWhenConnected(function(i){i.emit(new h.JoinPacket(e.rooms[t].id)),i.emit(new h.PingPacket(window.performance.now()))}),this.lastRoom=t,this.updatePlayer(0),this.updateSelectedDisplay(t)},t.prototype.spectate=function(){this.setIntroUIVisible(!1),this.setUIVisible(!1)},t.prototype.adjustColor=function(t){this.colorH+=t,this.colorH%=1},t.prototype.adjustSkin=function(t){var e=this.skincode;this.skincode=(e+t+c.MaxSkinCount)%c.MaxSkinCount},t.prototype.chooseRandomSkin=function(){this.skincode=Math.floor(Math.random()*c.MaxSkinCount)},t.prototype.chooseRandomColor=function(){this.colorH=Math.random(),this.colorS=Math.random()>.2?.9:.2,this.colorL=Math.random()>.2?.635:.6},t.prototype.getSelectedColor=function(){return Math.floor(255*this.colorH)|Math.floor(255*this.colorS)<<8|Math.floor(255*this.colorL)<<16},t.prototype.reconnect=function(){var t=this.area;this.gameStarted=!1,this.area=void 0,this.changeArea(t),this.loginAccumTime=0,this.hasJoined=!1},t.prototype.tryStart=function(t){var e=this;if(void 0===t&&(t=!1),this.isMobile)this.start();else{var i=t||this.flashAvailable&&this.screen.width>=500&&this.screen.height>=250,r=t||this.deathTimes>2&&this.gameDuration>90&&!this.adPlayed;if("undefined"!=typeof aipPlayer&&i&&r){this.setIntroUIVisible(!1);var o=this.screen.width/960;o=Math.min(1,o),o=Math.max(400/960,o);var s=Math.floor(960*o),a=Math.floor(540*o),n=new aipPlayer({AD_WIDTH:s,AD_HEIGHT:a,PREROLL_ELEM:document.getElementById("preroll"),AIP_COMPLETE:function(){e.start()}});n.startPreRoll(),this.deathTimes=0,this.gameDuration=0,this.adPlayed=!0,window.localStorage.setItem("adPlayed",(new Date).getTime().toString())}else this.start()}},t.prototype.filterName=function(){for(var t=this.swearFilter.split("A"),e=0,i=t;e<i.length;e++){for(var r=i[e],o=new RegExp(r,"gi"),s="â™¥",a=r.length,n="";a-- >0;)n+=s;this.name=this.name.replace(o,n)}},t.prototype.start=function(){var t=this;if(this.responseReceived=!1,setTimeout(function(){t.responseReceived||window.location.reload(!0)},4e3),this.loginAccumTime=0,this.doAutoLogin=!0,this.startButton.innerHTML="Connecting...",this.startButton.disabled=!0,this.hasJoined&&this.net){if(this.net.isClosed)return void(this.area&&this.reconnect());if(this.net.isReady){this.startButton.innerHTML="Play",this.startButton.disabled=!1,this.isDead=!1;var e=this.nameText.value;localStorage.setItem("name",e),this.name=e.substring(0,25),this.filterName(),this.net.emit(new h.StartPacket(this.name,this.skincode,this.getSelectedColor())),this.setIntroUIVisible(!1),this.setUIVisible(!0),this.lvnum.innerText="1",this.doAutoLogin=!1}}},t.prototype.queryInput=function(){var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];if(t){if("none"!=this.spawnbox.style.display)for(var e=0;e<t.length;e++){var i=t[e];if(!i)break;for(var r=!1,o=0;o<4;++o)if(i.buttons[o].pressed){this.padActivated=!0,this.start(),r=!0;break}if(r)break}if(this.target.changed)return this.padActivated=!1,!1;if(!this.padActivated)for(var e=0;e<t.length;e++){var i=t[e],s=.7;if(!i)break;for(var r=!1,a=0;a<4;a++)if(Math.abs(i.axes[a])>s){this.padActivated=!0,r=!0;break}if(r)break;for(var n=0;n<i.buttons.length;++n)if(i.buttons[n].pressed){this.padActivated=!0;break}}if(this.padActivated&&this.gameStarted&&"none"==this.spawnbox.style.display){var h=1;this.isDead&&(h=.1);for(var e=0;e<t.length;e++){var i=t[e],s=.1;if(!i)break;var l=i.axes[0],c=i.axes[1];l=Math.abs(l)<s?0:l,c=Math.abs(c)<s?0:c,0==l&&0==c&&(l=i.axes[2],c=i.axes[3],l=Math.abs(l)<s?0:l,c=Math.abs(c)<s?0:c),l>.9?l=1:l<-.9&&(l=-1),c>.9?c=1:c<-.9&&(c=-1),l*=h,c*=h,Math.abs(this.target.x-l)+Math.abs(this.target.y-c)>s&&(this.target.changed=!0,this.target.x=l,this.target.y=c),i.buttons[2].pressed?this.cannotDash||(this.tryDash(),this.cannotDash=!0):this.cannotDash=!1,i.buttons[0].pressed||i.buttons[1].pressed||i.buttons[3].pressed||i.buttons[7].pressed?this.cannotRetreat||(this.tryRetreat(),this.cannotRetreat=!0):this.cannotRetreat=!1}}}},t.prototype.loop=function(){var t=this;window.requestAnimationFrame(function(e){var i=e-t.lastTick,r=.001*i/t.timeSlowFactor;t.net&&t.net.consumeCache(),t.queryInput(),t.update(r),t.displayNarwhal.alpha>0&&t.displayNarwhal.updateDisplay(r),t.render(r),t.lastTick=e,t.loop()})},Object.defineProperty(t.prototype,"isTeamPlay",{get:function(){return this.fieldOptions&&this.fieldOptions.fieldType==m.FieldType.Soccer},enumerable:!0,configurable:!0}),t.prototype.update=function(t){this.doAutoLogin&&this.start(),this.net&&this.net.isClosed&&this.gameStarted&&(this.gameStarted=!1,this.isDead=!1,this.setIntroUIVisible(!0),this.setUIVisible(!1),this.reconnect()),this.extraShrinkRatio=.8*this.extraShrinkRatio+.2*this.targetviewscale;var e=this.isTeamPlay?2:0;this.maxLeaderDisplay=Math.min(Math.max(Math.floor(window.innerHeight-150-60*e)/60,0),5-e);for(var i in this.serverElements)this.serverElements[i].update(t);var r=[];for(var o in this.elements)this.serverElements[o]||r.push(parseInt(o));for(var s in this.serverElements)this.elements[s]||(this.elements[s]=this.serverElements[s]);for(var a=0,n=r;a<n.length;a++){var i=n[a],c=this.elements[i].tryEndRender(this.layers,this.renderFactory,this,t);c&&delete this.elements[i]}var d=3.74,p=1.55*.55,u=.35,y=.1,f=Math.max(Math.min(this.meanThrotling,d),p),v=(d-f)/(d-p)*(u-y)+y;for(var s in this.elements)this.elements[s].refreshFrom(this.serverElements[s],t,v);var g=[];for(var i in this.clientElements){var w=this.clientElements[i];w.update(t),(void 0==w.shouldEndRender||w.shouldEndRender)&&g.push(parseFloat(i))}for(var T=0,x=g;T<x.length;T++){var i=x[T];this.clientElements[i].tryEndRender(this.layers,this.renderFactory,this,t)&&delete this.clientElements[i]}if(this.updatePlayer(t),this.gameStarted){var b=window.performance.now();this.target.changed&&(this.net.emit(new h.UpdateTargetPacket(this.target.x,this.target.y)),this.lastTargetUpdateTime=b,this.target.changed=!1)}!this.gameStarted||this.isDead?(this.loginAccumTime+=t,this.loginAccumTime>this.options.loginTimeout&&(this.net.close(),this.isDead=!1,this.gameStarted=!1)):this.loginAccumTime=0,this.gameStarted&&(this.gameDuration+=t,window.sessionStorage.setItem("gameDuration",this.gameDuration.toString())),(this.deathTimes>25||this.gameDuration>1800)&&(this.deathTimes=0,this.gameDuration=0,this.adPlayed=!1),this.gameStarted&&!this.isDead&&this.fieldOptions.fieldType==m.FieldType.Soccer?this.indicatorElement||(this.indicatorElement=new l.ArrowElement):this.indicatorElement&&(this.indicatorElement.tryEndRender(this.layers,this.renderFactory,this),this.indicatorElement=void 0)},t.prototype.updatePlayer=function(t){if(this.gameStarted){var e=this.elements[this.player.id],i=Math.min(60*t,1),r=0==t?0:.8*i;e&&(this.player.x=e.parts[0].x*r+this.player.x*(1-r),this.player.y=e.parts[0].y*r+this.player.y*(1-r))}else this.fieldOptions&&(this.player.x=this.fieldOptions.width/2,this.player.y=this.fieldOptions.height/2);if(this.serverElements[this.player.id]){var e=this.serverElements[this.player.id];this.dashable=e.curDash>0&&e.invincibleDur<.001}},t.prototype.clearJoyStickIcon=function(){this.joySprite&&(this.layers.uiDraw.removeChild(this.joySprite),this.joySprite.destroy(),this.joySprite=void 0),this.joySprite2&&(this.layers.uiDraw.removeChild(this.joySprite2),this.joySprite2.destroy(),this.joySprite2=void 0)},t.prototype.clearDragTutorial=function(){this.dragLine&&(this.layers.uiDraw.removeChild(this.dragLine),this.dragLine.destroy(),this.dragLine=void 0),this.dragTutorialText&&(this.layers.uiDraw.removeChild(this.dragTutorialText),this.dragTutorialText.destroy(),this.dragTutorialText=void 0),this.dragTutorialDecay=0},t.prototype.clearJoyStickTutorial=function(){this.clearJoyStickIcon(),this.joyLine&&(this.layers.uiDraw.removeChild(this.joyLine),this.joyLine.destroy(),this.joyLine=void 0),this.joyTutorialAtk&&(this.layers.uiDraw.removeChild(this.joyTutorialAtk),this.joyTutorialAtk.destroy(),this.joyTutorialAtk=void 0),this.joyTutorialDef&&(this.layers.uiDraw.removeChild(this.joyTutorialDef),this.joyTutorialDef.destroy(),this.joyTutorialDef=void 0),this.joyTutorialText&&(this.layers.uiDraw.removeChild(this.joyTutorialText),this.joyTutorialText.destroy(),this.joyTutorialText=void 0),this.joyTutorialDecay=0,this.joystickScale=1},t.prototype.render=function(t){var e=this.shrinkRatio*this.extraShrinkRatio;Math.abs(this.targetviewscale-this.extraShrinkRatio)>.001?this.grid.render(this.layers.gridDraw,this.shrinkRatio*this.extraShrinkRatio):this.targetviewscale!=this.extraShrinkRatio&&(this.extraShrinkRatio=this.targetviewscale,this.grid.render(this.layers.gridDraw,this.shrinkRatio*this.extraShrinkRatio)),this.layers.world2d.setTransform(this.screen.width/2-this.player.x*e,this.screen.height/2-this.player.y*e,e,e),this.layers.gridDraw.setTransform(this.screen.width/2-this.player.x*e,this.screen.height/2-this.player.y*e,1,1),
    this.indicatorElement&&this.indicatorElement.render(this.layers,this.renderFactory,this,t);for(var i in this.elements)this.elements[i].render(this.layers,this.renderFactory,this,t);for(var i in this.clientElements)this.clientElements[i].render(this.layers,this.renderFactory,this,t);if(this.touchActivated)if("none"!==this.spawnbox.style.display)this.clearJoyStickTutorial(),this.clearDragTutorial();else switch(this.controlMode){case v.Drag:this.renderDragTutorial(),this.clearJoyStickTutorial();break;case v.JoyStick:case v.Mirror:this.renderJoyStickTutorial(),this.clearDragTutorial()}else this.clearJoyStickTutorial(),this.clearDragTutorial();var r=this.fieldOptions&&this.fieldOptions.fieldType==m.FieldType.Soccer?8367937:this.options.backgroundColor;this.renderer.backgroundColor=r,this.renderer.render(this.layers.stage),this.renderDisplayNarwhal()},t.prototype.renderDisplayNarwhal=function(){var t=this.shrinkRatio*this.extraShrinkRatio,e=this.customizer.getBoundingClientRect();e.left*window.devicePixelRatio<this.screen.width-15&&"none"!==this.spawnbox.style.display?(this.displayNarwhal.alpha+=.15,this.displayNarwhal.alpha=Math.min(this.displayNarwhal.alpha,1)):this.displayNarwhal.alpha*=.7,this.displayNarwhal.alpha>0&&(this.displayNarwhal.render(this.smalllayers,this.renderFactory,this,void 0),this.displayNarwhal.color=this.getSelectedColor(),this.displayNarwhal.setSkinCode(this.skincode),this.smalllayers.world2d.setTransform(this.screen.width-380*t,e.top*window.devicePixelRatio-70*t,t,t),this.renderer.clearBeforeRender=!1,this.renderer.render(this.smalllayers.stage),this.renderer.clearBeforeRender=!0)},t.prototype.renderDragTutorial=function(){this.dragLine||(this.dragLine=new PIXI.Graphics,this.layers.uiDraw.addChild(this.dragLine)),this.dragTutorialText||(this.dragTutorialText=new PIXI.Text("Double Tap = Attack",{font:"bold 30px Helvetica",fill:0,align:"center"}),this.dragTutorialText.anchor.set(.5,.5),this.dragTutorialText.alpha=this.dragTutorialDecay>0?0:.15,this.layers.uiDraw.addChild(this.dragTutorialText)),this.dragLine.clear(),this.dragLine.lineStyle(this.dragLineWidth,0,.075);var t=this.screen.width/2,e=this.screen.height/2,i=Math.sqrt(this.target.x*this.target.x+this.target.y*this.target.y);if(i<.01||this.isDead)this.dragLine.alpha=0;else{i=Math.max(1e-4,i);var r=Math.min(t,e);this.dragLine.moveTo(t+this.target.x/i*30*window.devicePixelRatio,e+this.target.y/i*30*window.devicePixelRatio),this.dragLine.lineTo(t+this.target.x*r/2,e+this.target.y*r/2),this.dragLine.alpha=this.dragLineAlpha,this.dragLineAlpha*=1-this.dragLineAlphaDecay,this.dragLineWidth=.8*this.dragLineWidth+2}this.dragTutorialText.alpha*=1-this.dragTutorialDecay,this.dragTutorialText.setTransform(t,e+80*window.devicePixelRatio)},t.prototype.renderJoyStickTutorial=function(){if(!this.joyLine){this.joyLine=new PIXI.Graphics,this.joyLine.lineStyle(8,15658734,.3),this.joyLine.moveTo(0,0);for(var t=0,e=0,i=5*window.devicePixelRatio,r=i*this.options.defaultJoySplitRatio,o=5*window.devicePixelRatio,s=o*this.options.defaultJoySplitRatio,a=Math.min(Math.max(.3*window.innerHeight,120),200)*window.devicePixelRatio;e<a;)this.joyLine.lineTo(-t,-e),t+=o,e+=s,this.joyLine.moveTo(-t,-e),t+=i,e+=r;this.layers.uiDraw.addChild(this.joyLine)}if(!this.joyTutorialText){var n=this.controlMode===v.JoyStick?"<--- Move | Action --->":"Double Tap = Attack";this.joyTutorialText=new PIXI.Text(n,{font:'bold 30px Helvetica, Arial, "Microsoft Yahei", STXihei, sans-serif',fill:0,align:"center"}),this.joyTutorialText.anchor.set(.5,.5),this.joyTutorialText.alpha=this.joyTutorialDecay>0?0:.15,this.layers.uiDraw.addChild(this.joyTutorialText)}var h=this.screen.width/2,l=this.screen.height/2;if(this.joyTutorialText.alpha*=1-this.joyTutorialDecay,this.joyTutorialText.setTransform(h,l+80*window.devicePixelRatio,this.tutTextScale*window.devicePixelRatio*.6,this.tutTextScale*window.devicePixelRatio*.6),this.tutTextScale=.7*this.tutTextScale+.3,this.joyTextColorScale=.8*this.joyTextColorScale+.03,this.controlMode==v.JoyStick&&(this.joyTutorialAtk||(this.joyTutorialAtk=new PIXI.Text("Atk",{font:"bold 30px Helvetica",fill:0,align:"center"}),this.joyTutorialAtk.alpha=.15,this.joyTutorialAtk.anchor.set(1,1),this.layers.uiDraw.addChild(this.joyTutorialAtk)),this.joyTutorialDef||(this.joyTutorialDef=new PIXI.Text("Def",{font:"bold 30px Helvetica",fill:0,align:"center"}),this.joyTutorialDef.alpha=.15,this.joyTutorialDef.anchor.set(0,1),this.layers.uiDraw.addChild(this.joyTutorialDef)),this.joyLine.setTransform(this.screen.width,this.screen.height),this.joyTutorialAtk.setTransform(this.screen.width-30*window.devicePixelRatio,this.screen.height,this.atkTextScale*window.devicePixelRatio,this.atkTextScale*window.devicePixelRatio),this.joyTutorialDef.setTransform(this.screen.width,this.screen.height-75*window.devicePixelRatio,this.defTextScale*window.devicePixelRatio,this.defTextScale*window.devicePixelRatio,-Math.PI/2),this.atkTextScale=.7*this.atkTextScale+.3,this.defTextScale=.7*this.defTextScale+.3),this.joystickAlpha>0&&(0!=this.initJoyX||0!=this.initJoyY)){var c=60,d=30,p=20,u=20,y=this.initJoyX+p,m=this.initJoyY-u;this.joySprite||(this.joySprite=new PIXI.Graphics,this.joySprite.beginFill(0,.25),this.joySprite.drawCircle(0,0,c*window.devicePixelRatio),this.joySprite.endFill(),this.layers.uiDraw.addChild(this.joySprite)),this.joySprite2||(this.joySprite2=new PIXI.Graphics,this.joySprite2.beginFill(16777215,.25),this.joySprite2.drawCircle(0,0,d*window.devicePixelRatio),this.joySprite2.endFill(),this.layers.uiDraw.addChild(this.joySprite2)),this.joySprite.setTransform(y*window.devicePixelRatio,m*window.devicePixelRatio,this.joystickScale,this.joystickScale);var f=this.lastJoyX+p,g=this.lastJoyY-u,i=f-y,r=g-m,w=Math.sqrt(i*i+r*r),T=c-d;w>T&&(f=i/w*T+y,g=r/w*T+m),this.joySprite2.setTransform(f*window.devicePixelRatio,g*window.devicePixelRatio,this.joystickScale,this.joystickScale),this.joySprite.alpha=this.joystickAlpha,this.joySprite2.alpha=this.joystickAlpha,this.joystickScale=.8*this.joystickScale+.2}else this.joySprite&&(this.layers.uiDraw.removeChild(this.joySprite),this.joySprite.destroy(),this.joySprite=void 0),this.joySprite2&&(this.layers.uiDraw.removeChild(this.joySprite2),this.joySprite2.destroy(),this.joySprite2=void 0);this.joystickAlpha*=1-this.joystickAlphaDecay},t.defaultOptions={viewScale:.69,backgroundColor:13487565,grid:{borderColor:7829367,borderSize:5,lineColor:11447982,lineSize:4,miniGridWidth:200,miniGridLineSize:1,miniGridLineColor:11447982},defaultWidth:1855,defaultHeight:995,defaultJoySplitRatio:1.2,loginTimeout:90,serverUpdatePeriodInSecs:60},t}();e.Game=g},function(t,e,i){"use strict";var r=i(7),o=function(){function t(t,e){this.uri=t,this.factory=e,this.callbacks={},this.isReady=!1,this.isClosed=!0,this.throtling=0,this.immediateResponse=!0,this.packetCache={}}return t.prototype.getID=function(t){return new DataView(t).getUint8(0)},t.prototype.decode=function(t){var e=new DataView(t),i=this.factory.create(e.getUint8(0));return i.parseData(e),i},t.prototype.close=function(){this.isClosed||(this.ws.onclose(void 0),this.ws.onclose=function(){},this.ws.close())},t.prototype.doWhenConnected=function(t){this.isReady?t(this):this.onConnect=t},t.prototype.open=function(){var t=this;this.isReady||this.isClosed&&(this.isClosed=!1,this.ws=new WebSocket(this.uri),this.ws.binaryType="arraybuffer",this.ws.onopen=function(){t.isReady=!0,t.onConnect&&t.onConnect(t)},this.ws.onclose=function(e){t.consumeCache(),t.isReady=!1,t.isClosed=!0,t.onDisconnect&&t.onDisconnect(t),t.immediateResponse=!0},this.ws.onerror=function(e){console.error("Error:",e),t.onError&&t.onError(e,t)},this.ws.onmessage=function(e){t.throtling++;var i=t.getID(e.data);t.callbacks[i]&&(t.immediateResponse?t.callbacks[i](t.decode(e.data),t):t.packetCache[i]=e.data)})},t.prototype.consumeCache=function(){if(!this.isClosed&&this.isReady){for(var t in this.packetCache)this.packetCache[t]&&(this.callbacks[t](this.decode(this.packetCache[t]),this),this.packetCache[t]=void 0);this.throtling=0}},t.prototype.on=function(t,e){this.callbacks[t]=e},t.prototype.emit=function(t){var e;e="number"==typeof t?new r.Packet(t):t,this.ws.send(e.getData())},t}();e.Network=o},function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(8),s=i(9),a=i(10),n=function(){function t(t){this.id=t}return t.prototype.parseData=function(t){},t.prototype.getData=function(){var t=new ArrayBuffer(1),e=new DataView(t);return e.setUint8(0,this.id),t},t}();e.Packet=n;var h=function(t){function e(){t.call(this,s.PacketID.RIP)}return r(e,t),e}(n);e.RIPPacket=h;var l=function(){function t(){}return t}(),c=function(t){function e(){t.call(this,s.PacketID.TeamInfo)}return r(e,t),e.prototype.parseData=function(t){var e=1;this.leftTeamScore=t.getUint8(e),e+=1,this.rightTeamScore=t.getUint8(e),e+=1,this.winTeam=t.getInt8(e),this.isGameFinished=this.winTeam>=0,e+=1,this.isRoundDone=t.getUint8(e)>0,e+=1},e}(n);e.TeamInfoPacket=c;var d=function(t){function e(){t.call(this,s.PacketID.LeaderBoard)}return r(e,t),e.prototype.parseData=function(t){var e=1,i=t.getUint8(e);this.record=new Array,e+=1;for(var r=0;r<i;++r){var s=new l;s.level=t.getUint8(e),e+=1,a=o.parseString(t,e),e=a[0],s.name=a[1],this.record.push(s)}this.scores=new Array,i=t.getUint8(e),e+=1;for(var r=0;r<i;++r)this.scores[r]=t.getUint8(e),e+=1;var a},e}(n);e.LeaderBoardPacket=d;var p=function(t){function e(e,i){t.call(this,s.PacketID.UpdateTarget),this.x=e,this.y=i}return r(e,t),e.prototype.getData=function(){var t=new ArrayBuffer(9),e=new DataView(t);return e.setUint8(0,this.id),e.setFloat32(1,this.x,!0),e.setFloat32(5,this.y,!0),t},e}(n);e.UpdateTargetPacket=p;var u=function(t){function e(e,i){t.call(this,s.PacketID.Retreat),this.x=e,this.y=i}return r(e,t),e.prototype.getData=function(){var t=new ArrayBuffer(9),e=new DataView(t);return e.setUint8(0,this.id),e.setFloat32(1,this.x,!0),e.setFloat32(5,this.y,!0),t},e}(n);e.RetreatPacket=u;var y=function(t){function e(e,i){t.call(this,s.PacketID.SplitUp),this.x=e,this.y=i}return r(e,t),e.prototype.getData=function(){var t=new ArrayBuffer(9),e=new DataView(t);return e.setUint8(0,this.id),e.setFloat32(1,this.x,!0),e.setFloat32(5,this.y,!0),t},e}(n);e.SplitUpPacket=y;var m=function(t){function e(e,i,r){t.call(this,s.PacketID.Start),this.name=e,this.skincode=i,this.colorcode=r}return r(e,t),e.prototype.getData=function(){var t=o.stringToUint(this.name),e=new Uint8Array(1+t.length+4+4),i=new DataView(e.buffer);return i.setUint8(0,this.id),i.setUint32(1,this.skincode,!0),i.setUint32(5,this.colorcode,!0),e.set(t,9),e.buffer},e.prototype.parseData=function(t){this.uid=t.getUint16(1,!0)},e}(n);e.StartPacket=m;var f=function(t){function e(e){t.call(this,s.PacketID.Ping),this.now=e}return r(e,t),e.prototype.getData=function(){var t=new ArrayBuffer(5),e=new DataView(t);return e.setUint8(0,this.id),e.setFloat32(1,this.now,!0),t},e.prototype.parseData=function(t){this.now=t.getFloat32(1,!0)},e}(n);e.PingPacket=f;var v=function(t){function e(e){t.call(this,s.PacketID.Join),this.lobbyID=e}return r(e,t),e.prototype.getData=function(){var t=new ArrayBuffer(5),e=new DataView(t);return e.setUint8(0,this.id),e.setUint32(1,this.lobbyID,!0),t},e}(n);e.JoinPacket=v;var g=function(t){function e(e,i){t.call(this,e),this.id=e,this.data=i}return r(e,t),e.prototype.getData=function(){if(console.log("JsonData",this.id,this.data),this.data){var e=o.stringToUint(JSON.stringify(this.data)),i=new Uint8Array(1+e.length);return i.set([this.id],0),i.set(e,1),i.buffer}return t.prototype.getData.call(this)},e.prototype.parseData=function(t){var e=o.parseString(t,1),i=(e[0],e[1]);this.data=JSON.parse(i)},e}(n);e.JsonPacket=g;var w=function(t){function e(){t.call(this,s.PacketID.PlayerInfo)}return r(e,t),e.prototype.parseData=function(t){var e=1;this.level=t.getUint8(e),e+=1;var i=t.getUint8(e);e+=1,this.upgrade=new Array;for(var r=0;r<i;++r)this.upgrade.push(t.getUint8(e)),e+=1},e}(n);e.PlayerInfoPacket=w;var T;!function(t){t[t.Fish=0]="Fish",t[t.Ball=1]="Ball"}(T||(T={}));var x=function(t){function e(){t.call(this,s.PacketID.SetElements),this.elements=new Array}return r(e,t),e.prototype.parseData=function(t){var i,r=1;for(this.time=t.getFloat64(r,!0),r+=8,this.slowFactor=t.getUint8(r),r+=1,this.indicatorX=t.getUint16(r,!0)/65535,r+=2,this.indicatorY=t.getUint16(r,!0)/65535,r+=2;r<t.byteLength;)o=e.parseElementData(t,r),r=o[0],i=o[1],this.elements.push(i);var o},e.parseElementData=function(t,e){var i=t.getUint8(e);switch(e+=1,i){case T.Fish:return this.parseFish(t,e);case T.Ball:return this.parseBall(t,e)}},e.parseBall=function(t,e){var i=new a.BallElement;i.id=t.getUint32(e,!0),e+=4,i.x=t.getFloat32(e,!0),e+=4,i.y=t.getFloat32(e,!0),e+=4;var r=t.getUint16(e,!0);e+=2;var o=t.getInt8(e)/127*Math.PI;return e+=1,i.vx=r*Math.cos(o),i.vy=r*Math.sin(o),[e,i]},e.parseFish=function(t,e){var i=new a.ChainElement;i.parts=[],i.id=t.getUint32(e,!0),e+=4,i.color=0;for(var r=0;r<3;++r)i.color<<=8,i.color+=t.getUint8(e),e+=1;g=o.parseString(t,e),e=g[0],i.name=g[1],i.size=36;var s=t.getUint8(e);i.team=7&s,i.breakPoint=s>>3&31,e+=1,i.alpha=t.getUint8(e)/255,e+=1;var n=t.getUint8(e);e+=1,i.maxDash=15&n,i.curDash=n>>4&15,i.overDash=t.getUint8(e)/255,e+=1,i.tuskRatio=t.getUint8(e)/255*2,e+=1,i.decoration=t.getUint8(e),e+=1;var h=t.getFloat32(e,!0);e+=4;var l=t.getFloat32(e,!0);e+=4;var c=t.getUint16(e,!0);e+=2;var d=t.getInt8(e)/127*Math.PI;e+=1;var p=c*Math.cos(d),u=c*Math.sin(d),y=t.getInt8(e)/127*Math.PI;e+=1;var m=new a.ChainElementUnit;m.x=h,m.y=l,m.vx=p,m.vy=u,m.rot=y,i.parts.push(m),i.setSkinCode(t.getUint8(e)),e+=1,i.invincibleDur=t.getUint8(e)/255*2,e+=1;var f=t.getUint8(e);e+=1;for(var r=1;r<f+1;++r){var v=new a.ChainElementUnit;r!=i.breakPoint?(v.rot=t.getInt8(e)/127*Math.PI,e+=1,v.vt=0):(v.x=t.getFloat32(e,!0),e+=4,v.y=t.getFloat32(e,!0),e+=4,v.vx=t.getFloat32(e,!0),e+=4,v.vy=t.getFloat32(e,!0),e+=4),i.parts.push(v)}return[e,i];var g},e}(n);e.SetElementsPacket=x;var b=function(t){function e(){t.call(this,s.PacketID.TransientElement)}return r(e,t),e.prototype.parseData=function(t){var e=1;this.type=t.getUint8(e),e+=1,this.x=t.getUint16(e,!0)/65535,e+=2,this.y=t.getUint16(e,!0)/65535,e+=2},e.prototype.getPos=function(t,e){return[2*t*this.x-t/2,e*this.y*2-e/2]},e}(n);e.TransientElementPacket=b},function(t,e){"use strict";function i(t,e){for(var i in e)t[i]=e[i];return t}function r(t){t=encodeURIComponent(t);for(var e=[],i=0,r=t;i<r.length;i++){var o=r[i];e.push(o.charCodeAt(0))}return e}function o(t){var e=String.fromCharCode.apply(String,t);return decodeURIComponent(e)}function s(t,e){for(var i=[];;){var r=t.getUint8(e++);if(0==r)break;i.push(r)}return[e,o(i)]}function a(t){return t<<16|t<<8|t}function n(t,e,i){var r,o,s;if(0==e)r=o=s=i;else{var a=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},n=i<.5?i*(1+e):i+e-i*e,h=2*i-n;r=a(h,n,t+1/3),o=a(h,n,t),s=a(h,n,t-1/3)}return(Math.floor(255*r)<<16)+(Math.floor(255*o)<<8)+Math.floor(255*s)}e.extend=i,e.stringToUint=r,e.uintToString=o,e.parseString=s,e.getGrey=a,e.hslToRgb=n},function(t,e){"use strict";!function(t){t[t.Join=16]="Join",t[t.Leave=17]="Leave",t[t.Start=18]="Start",t[t.GetLobbies=19]="GetLobbies",t[t.UpdateTarget=32]="UpdateTarget",t[t.SplitUp=33]="SplitUp",t[t.RIP=34]="RIP",t[t.Retreat=35]="Retreat",t[t.PlayerUpdate=36]="PlayerUpdate",t[t.Ping=37]="Ping",t[t.SetElements=48]="SetElements",t[t.PlayerInfo=49]="PlayerInfo",t[t.LeaderBoard=50]="LeaderBoard",t[t.TeamInfo=51]="TeamInfo",t[t.TransientElement=52]="TransientElement",t[t.GetStats=64]="GetStats",t[t.INVALID=65]="INVALID"}(e.PacketID||(e.PacketID={}));e.PacketID},function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},o=i(8),s=i(11),a=i(8),n=i(12),h=i(13),l=function(){function t(){}return t}();e.InfoElement=l;var c=function(){function t(){this.color=16777215,this.alpha=1,this.accum_dt=0}return Object.defineProperty(t.prototype,"shouldEndRender",{get:function(){return this.alpha<.001},enumerable:!0,configurable:!0}),t.prototype.update=function(t){var e=Math.min(60*t,1);this.accum_dt+=t,this.accum_dt>2&&(this.alpha*=1-.2*e)},t.prototype.render=function(t,e,i,r){this.sprite||(this.sprite=new PIXI.Graphics,t.worldElemFullScreenCover.addChild(this.sprite),this.sprite.beginFill(this.color),this.sprite.drawRect(-5e3,-5e3,1e4,1e4),this.sprite.endFill(),this.sprite.rotation=0),this.sprite.alpha=this.alpha,this.sprite.position.set(i.player.x,i.player.y)},t.prototype.tryEndRender=function(t,e,i,r){return this.sprite=void 0,!0},t}();e.FullScreenElement=c;var d=function(){function t(){this.scale=.001,this.alpha=1,this.accum_dt=0}return Object.defineProperty(t.prototype,"shouldEndRender",{get:function(){return this.alpha<.001},enumerable:!0,configurable:!0}),t.prototype.update=function(t){var e=Math.min(60*t,1);this.accum_dt+=t,this.accum_dt>1&&(this.alpha*=1-.05*e),this.alpha<.001&&(this.alpha=0),this.scale=Math.min(this.scale+.7*(3-this.scale)*t*60,3)},t.prototype.render=function(t,e,i){this.sprite||(this.sprite=e.popSprite(),t.worldElemFullScreenCoverAbove.addChild(this.sprite),this.sprite.anchor.set(.5,.5),this.sprite.rotation=-Math.PI/2),this.sprite.alpha=this.alpha,this.sprite.texture=i.textureMan.getNamedTexture("explosion"),this.sprite.position.set(this.x,this.y);var r=Math.min(.1*this.accum_dt+this.scale,3.5);this.sprite.scale.set(r,r)},t.prototype.tryEndRender=function(t,e,i,r){return this.sprite&&(e.recycleElement(this.sprite),this.sprite=void 0),!0},t}();e.SmokeExplosionElement=d;var p=function(){function t(t,e){this.text=t,this.lifetime=e,this.x=0,this.y=0,this.vx=0,this.vy=0,this.color=16777215,this.scale=1}return Object.defineProperty(t.prototype,"shouldEndRender",{get:function(){return this.lifetime<0},enumerable:!0,configurable:!0}),t.prototype.render=function(t,e,i){this.textElem||(this.textElem=e.popText(),t.uiDraw.addChild(this.textElem),this.textElem.text=this.text,this.textElem.anchor.set(.5,.5),this.textElem.tint=this.color);i.shrinkRatio;this.textElem.position.set(this.x+i.screen.width/2,this.y+i.screen.height/2),this.textElem.alpha=Math.min(this.lifetime,1),this.textElem.alpha*=this.textElem.alpha,this.textElem.scale.set(1.3*i.shrinkRatio,1.3*i.shrinkRatio)},t.prototype.tryEndRender=function(t,e,i){return e.recycleElement(this.textElem),!0},t.prototype.update=function(t){var e=Math.min(60*t,1);this.x+=this.vx*t,this.y+=this.vy*t,this.vx*=1-.02*e,this.vy*=1-.02*e,this.lifetime-=t},t}();e.TextElement=p;var u=function(){function t(){this.lastdeltax=0,this.lastdeltay=0,this.lastangle=0,this.alpha=0}return t.prototype.render=function(t,e,i,r){this.arrowSprite||(this.arrowSprite=e.popSprite(),t.worldDraw.addChild(this.arrowSprite));var o=.1;this.arrowSprite.texture=i.textureMan.getNamedTexture("arrow");var s=i.indicatorX-i.player.x,a=i.indicatorY-i.player.y,n=Math.sqrt(s*s+a*a);this.arrowSprite.alpha=this.alpha,this.arrowSprite.tint=0,n<1300?this.alpha*=.95:this.alpha+=.05*(o-this.alpha);var h=s/n*300,l=a/n*300;this.lastdeltax=.9*this.lastdeltax+.1*h,this.lastdeltay=.9*this.lastdeltay+.1*l,this.arrowSprite.position.set(i.player.x+this.lastdeltax,i.player.y+this.lastdeltay),this.arrowSprite.rotation=Math.atan2(this.lastdeltay,this.lastdeltax)},t.prototype.tryEndRender=function(t,e,i){return this.arrowSprite&&(e.recycleElement(this.arrowSprite),this.arrowSprite=void 0),!0},t.prototype.update=function(t){},t}();e.ArrowElement=u;var y=function(){function t(){}return t.prototype.update=function(t){this.x+=this.vx*t,this.y+=this.vy*t},t.prototype.updaterel=function(t,e,i,r,o,s,a){var n=Math.min(1,60*o);this.vt-=this.vt*s*n,this.rot+=o*this.vt;for(var h=this.rot-i;h>Math.PI;)h-=2*Math.PI;for(;h<-Math.PI;)h+=2*Math.PI;h>a?this.vt>0&&(this.vt*=1-.75*n):h<-a&&this.vt<0&&(this.vt*=1-.75*n),this.x=t+Math.cos(this.rot+Math.PI)*r,this.y=e+Math.sin(this.rot+Math.PI)*r},t}();e.ChainElementUnit=y;var m=function(){function t(){}return t}();e.ChainRenderable=m;var f=function(){function t(){this.scale=1,this.slowCounter=0}return t.prototype.update=function(t){var e=Math.min(60*t,1);this.x+=t*this.vx,this.y+=t*this.vy,this.vx*=1-.005*e,this.vy*=1-.005*e},t.prototype.render=function(t,e,i,r){this.ballSprite||(this.ballSprite=new PIXI.Graphics),this.shadowSprite||(this.shadowSprite=e.popSprite(),this.shadowSprite.anchor.set(.5,.5),t.world2d.addChild(this.shadowSprite)),this.tileSprite||(this.tileSprite=new PIXI.extras.TilingSprite(i.textureMan.getNamedTexture("balltile"),1e3,1e3),this.tileSprite.mask=this.ballSprite,t.worldElemVeryTopMost.addChild(this.tileSprite),this.tileSprite.anchor.set(.5,.5),this.tileSprite.tileScale.set(1.5,1.5)),i.timeSlowFactor>1&&(this.slowCounter+=r*i.timeSlowFactor,this.slowCounter>.5&&(this.scale=Math.max(.2,1+(Math.random()-.5)*(this.slowCounter-.5)*.125-(this.slowCounter-.5)/4)));var o=this.scale;this.shadowSprite.texture=i.textureMan.getNamedTexture("ball"),this.shadowSprite.position.set(this.x,this.y),this.shadowSprite.scale.set(1.001*o,1.001*o),this.tileSprite.texture=i.textureMan.getNamedTexture("balltile"),this.tileSprite.position.set(this.x,this.y),this.tileSprite.tilePosition.set(this.x,this.y),this.tileSprite.scale.set(o,o),this.ballSprite.clear(),this.ballSprite.beginFill(16777215);var s=i.extraShrinkRatio*i.shrinkRatio;this.ballSprite.drawCircle((this.x-i.player.x)*s+i.screen.width/2,(this.y-i.player.y)*s+i.screen.height/2,250*s*o),this.ballSprite.endFill()},t.prototype.tryEndRender=function(t,e,i){return e.recycleElement(this.shadowSprite),this.tileSprite.parent.removeChild(this.tileSprite),this.tileSprite.mask=void 0,this.tileSprite=void 0,this.ballSprite=void 0,this.shadowSprite=void 0,!0},t.prototype.smoothFrom=function(t,e){var i=t;this.isSlowed=i.isSlowed,this.slowCounter=i.slowCounter},t.prototype.refreshFrom=function(t,e,i){var r=t,o=r.x-this.x,s=r.y-this.y;this.scale=.1*r.scale+.9*this.scale;var a=Math.min(60*e,1);this.x+=o*i*a,this.y+=s*i*a},t}();e.BallElement=f;var v=function(t){function e(){t.apply(this,arguments),this.team=-1,this.invincibleDur=0,this.decorationStrength=0,this.renderables=[],this.skinNum=0,this.skin=0,this.hats=0,this.trophy=0,this.eyewear=0,this.reserved=0}return r(e,t),e.prototype.smoothFrom=function(t,e){var i=t;""===this.name&&(this.name=i.name);var r;for(var o in this.parts){var s=this.parts[o];if(o==this.breakPoint.toString()&&(r=void 0),r){for(var a=i.parts[o],n=s,h=n.rot-a.rot;h>Math.PI;)h-=2*Math.PI;for(;h<-Math.PI;)h+=2*Math.PI;n.vt=.2*n.vt+h/e*.8}r=s}},e.prototype.refreshFrom=function(t,e,i){var r=t,o=this;o.alpha=r.alpha,o.color=r.color,o.curDash=r.curDash,o.maxDash=r.maxDash,o.invincibleDur=r.invincibleDur,o.name=r.name,o.overDash=r.overDash,o.size=r.size,o.tuskRatio=r.tuskRatio,o.decoration=r.decoration,o.team=r.team;var s=Math.min(60*e,1),a=.05*s;o.decorationStrength=o.decorationStrength*(1-a)+(1&r.decoration)*a,o.breakPoint!=r.breakPoint&&(o.breakPoint=r.breakPoint,o.parts.splice(o.breakPoint,1));for(var n in o.parts){var h=o.parts[n],l=r.parts[n],c=l.x-h.x,d=l.y-h.y;h.x+=c*i*s,h.y+=d*i*s}},e.prototype.setSkinCode=function(t){this.skin=t},e.prototype.extendChain=function(t){var e=t[t.length-2],i=t[t.length-3];t[t.length-1].set(e.x+(e.x-i.x),e.y+(e.y-i.y));var r=t[1],o=t[2];t[0].set(r.x+(r.x-o.x),r.y+(r.y-o.y))},e.prototype.processChain=function(t,e){t.reverse(),this.extendChain(t)},e.prototype.render=function(t,e,i,r){this.robj||(this.robj=new m);var l=this.id==i.player.id?t.worldElemTopMost:t.worldElemTop,c=this.id==i.player.id?t.worldElemTopMostAbove:t.worldElemTopAbove,d=.4,p=this.invincibleDur<1?this.invincibleDur<.5?1-d:2*(1-this.invincibleDur)*(1-d):0,u=p/(1-d),y=this.invincibleDur>0?p+d:this.alpha,f=(255&this.color)/255,v=(255&this.color>>8)/255,g=(255&this.color>>16)/255;if(g=g>.2?.635:.6,v=v>.2?.9:.2,i.fieldOptions.fieldType==h.FieldType.Soccer){var w=0==this.team?.11667:.61667;f=w+(f-.5)/.5*.02,v=1}var T=a.hslToRgb(f,v,g),x=Math.atan2(this.parts[0].y-this.parts[1].y,this.parts[0].x-this.parts[1].x);this.robj.headAnchor||(this.robj.headAnchor=e.popContainer(),l.addChild(this.robj.headAnchor)),this.robj.headAnchorBack||(this.robj.headAnchorBack=e.popContainer(),t.worldElemBack.addChild(this.robj.headAnchorBack)),this.robj.headAnchorTop||(this.robj.headAnchorTop=e.popContainer(),c.addChild(this.robj.headAnchorTop)),this.robj.headAnchorBackMostUnrotated||(this.robj.headAnchorBackMostUnrotated=e.popContainer(),t.worldElemBackMost.addChild(this.robj.headAnchorBackMostUnrotated)),this.robj.headAnchor.setTransform(this.parts[0].x,this.parts[0].y,1,1,x),this.robj.headAnchorTop.setTransform(this.parts[0].x,this.parts[0].y,1,1,x),this.robj.headAnchorBack.setTransform(this.parts[0].x,this.parts[0].y,1,1,x),this.robj.headAnchorBackMostUnrotated.setTransform(this.parts[0].x,this.parts[0].y,1,1,0);var b=2*this.breakPoint+1;this.robj.body?this.robj.body.points.length!==b&&(e.recycleElement(this.robj.body),this.robj.body=e.popRope(b),l.addChild(this.robj.body),this.robj.body.dirty=!0):(this.robj.body=e.popRope(b),l.addChild(this.robj.body));for(var S=this.robj.body,k=S.points,I=0;I<this.breakPoint;I+=1)k[2*I+1].set(this.parts[I].x,this.parts[I].y);s.smoothInplace(k);var D=this.skin,P=n.GetMeta(this.skin);i.fieldOptions.fieldType==h.FieldType.Soccer&&P.NoColorOverlay&&(D=0);var C=i.textureMan.getSkinnedTexture(D,T);this.processChain(k,e),S.texture=C,S.alpha=y;var M=(this.parts.length-this.breakPoint)/this.parts.length;if(s.initUvs(S.uvs,M,1),this.breakPoint<this.parts.length){var R=2*(this.parts.length-this.breakPoint)+1;this.robj.body2||(this.robj.body2=e.popRope(R),l.addChild(this.robj.body2));for(var E=this.robj.body2.points,I=this.breakPoint;I<this.parts.length;++I){var j=I-this.breakPoint;E[2*j+1].set(this.parts[I].x,this.parts[I].y)}s.smoothInplace(E),this.processChain(E,e);var A=this.robj.body2;A.texture=C,A.alpha=y;var U=(this.parts.length-this.breakPoint)/this.parts.length;s.initUvs(A.uvs,0,U),this.robj.body2.dirty=!0}this.robj.tusk||(this.robj.tusk=e.popSprite(),this.robj.headAnchorBack.addChild(this.robj.tusk),this.robj.tusk.anchor.set(0,.5),this.robj.tusk.position.set(0,0));var L=this.robj.tusk;L.texture=i.textureMan.getNamedTexture("tusk");var B=this.invincibleDur<.5?(.5-this.invincibleDur)/.5:1e-4;L.scale.set(this.tuskRatio*B,B),L.alpha=y*y,L.alpha*=L.alpha,this.tuskRatio>=.79&&(this.robj.kebab||(this.robj.kebab=e.popSprite(),this.robj.kebab.anchor.set(0,.5),this.robj.headAnchorBack.addChild(this.robj.kebab)),this.robj.kebab.texture=i.textureMan.getNamedTexture("kebab"),this.robj.kebab.alpha=y*y,this.robj.kebab.alpha*=this.robj.kebab.alpha),this.robj.dashDots||(this.robj.dashDots=e.popContainer(),this.robj.dashDots.position.set(this.size/2+10,0),this.robj.headAnchorTop.addChild(this.robj.dashDots));var F=this.robj.dashDots;for(F.alpha=y;F.children.length<this.maxDash;){var N=e.popSprite();N.texture=i.textureMan.circleTexture,N.anchor.set(.5,.5),N.alpha=1,F.addChild(N)}for(;F.children.length>this.maxDash;){var X=F.children.pop();e.recycleElement(X)}for(var j=0;j<this.maxDash;++j){var O=1,J=136,G=255,H=G,z=F.children[j];if(j>this.curDash)H=J,O=.5;else if(j==this.curDash){var W=this.overDash*this.overDash;W*=W,W*=W,H=G*W+J*(1-W),O=this.overDash>.9?1.6:.5}z.tint=o.getGrey(H),z.setTransform(20*j,-18,O,O),z.alpha=u}this.robj.eyeSprite||(this.robj.eyeSprite=e.popSprite(),this.robj.eyeSprite.anchor.set(.5,.5),this.robj.eyeSprite.tint=16777215,this.robj.eyeSprite.scale.set(-1,-1),this.robj.eyeSprite.position.set(5,0),this.robj.headAnchorTop.addChild(this.robj.eyeSprite));var V=n.GetMeta(this.skin);if(this.robj.eyeSprite.texture=V.EyeSprite?i.textureMan.getNamedTexture(V.EyeSprite):i.textureMan.eyeTexture,this.robj.eyeSprite.alpha=y*y,this.decorationStrength>0){this.robj.decoration||(this.robj.decoration=e.popSprite(),this.robj.decoration.anchor.set(.5,1.5),this.robj.decoration.rotation=-Math.PI/2,this.robj.headAnchorTop.addChild(this.robj.decoration));var Y=this.robj.decoration;Y.texture=i.textureMan.getNamedTexture("crown");var _=this.decorationStrength;Y.scale.set(.75*(2-_),.75*(2-_)),Y.alpha=_}else e.recycleElement(this.robj.decoration),this.robj.decoration=void 0;this.robj.nameText||(this.robj.nameText=e.popText(),this.robj.nameText.scale.set(1.1,1.1),this.robj.nameText.anchor.set(.5,.5),this.robj.headAnchorBackMostUnrotated.addChild(this.robj.nameText),this.robj.nameText.position.set(0,100)),this.robj.nameText.text=this.name,this.robj.nameText.alpha=y*y},e.prototype.tryEndRender=function(t,e,i){return this.robj&&(e.recycleElement(this.robj.headAnchor),e.recycleElement(this.robj.headAnchorBack),e.recycleElement(this.robj.headAnchorBackMostUnrotated),e.recycleElement(this.robj.headAnchorTop),e.recycleElement(this.robj.body),e.recycleElement(this.robj.body2),this.robj=void 0),!0},e.prototype.updateDisplay=function(t){this.curDash+=t;for(var e=0;e<this.parts.length;++e)this.parts[e].x=e*this.size,this.parts[e].y=5*Math.sin(10*this.curDash+e*Math.PI/2)},e.prototype.update=function(t){for(var e,i=0,r=0;r<this.parts.length;++r){this.breakPoint==r&&(e=void 0);var o=this.parts[r];if(e){var s=.05,a=.2,n=6.28/3*(r-1)/10;o.updaterel(e.x,e.y,i,this.size,t,(this.parts.length-r)/this.parts.length*(a-s)+s,n),i=o.rot}else o.update(t),i=o.rot;e=o}},e}(l);e.ChainElement=v},function(t,e){"use strict";function i(t,e,i,r){for(var o=0;o<t.length;o+=r)t[o]=t[o]*e+i}function r(t,e,i){for(var r=i-e,o=t.length/4,s=r/(o-1),a=0;a<t.length;a+=4){var n=e+s*(a/4);t[a]=n,t[a+2]=n,t[a+1]=0,t[a+3]=1}return t}function o(t){for(var e=1;e<t.length-2;e+=2)for(var i=1==e?1:e-2,r=e+2,o=r==t.length-2?r:r+2,s=t[i],a=t[e],n=t[r],h=t[o],l=.5;l<.99;l+=.5){var c=l*l,d=l*l*l,p=-.5*d+c-.5*l,u=1.5*d-2.5*c+1,y=-1.5*d+2*c+.5*l,m=.5*d-.5*c,f=t[e+1];f.x=p*s.x+u*a.x+y*n.x+m*h.x,f.y=p*s.y+u*a.y+y*n.y+m*h.y}return t}function s(t){for(var e=new Array,i=0;i<t.length-1;++i){e.push(t[i]);for(var r=0==i?0:i-1,o=i+1,s=o==t.length-1?o:o+1,a=t[r],n=t[i],h=t[o],l=t[s],c=.5;c<1;c+=.5){var d=c*c,p=c*c*c,u=-.5*p+d-.5*c,y=1.5*p-2.5*d+1,m=-1.5*p+2*d+.5*c,f=.5*p-.5*d,v=new PIXI.Point;v.x=u*a.x+y*n.x+m*h.x+f*l.x,v.y=u*a.y+y*n.y+m*h.y+f*l.y,e.push(v)}}return e.push(t[t.length-1]),e}e.arrayTransform=i,e.initUvs=r,e.smoothInplace=o,e.smooth=s},function(t,e){"use strict";function i(t){return e.SkinMeta[t]?e.SkinMeta[t]:o}var r=function(){function t(){this.NoColorOverlay=!1,this.NoMask=!1,this.UseRawSkin=!1}return t}();e.SkinInfo=r,e.MaxSkinNum=16,e.MaxSkinCount=e.MaxSkinNum+1,e.SkinMeta={5:{NoColorOverlay:!0},10:{NoColorOverlay:!0},11:{NoMask:!0},12:{NoMask:!0},13:{NoColorOverlay:!0,NoMask:!0},14:{UseRawSkin:!0,CullMask:"mask0",EyeSprite:"eye1"},15:{UseRawSkin:!0,CullMask:"mask1"},16:{UseRawSkin:!0,EyeSprite:"eye0"}};var o=new r;e.GetMeta=i},function(t,e){"use strict";!function(t){t[t.Normal=0]="Normal",t[t.Soccer=1]="Soccer"}(e.FieldType||(e.FieldType={}));e.FieldType},function(t,e){"use strict";var i=function(){function t(t,e){this.sizeInfo=t,this.drawInfo=e}return t.prototype.render=function(t,e){var i=this.sizeInfo.width*e,r=this.sizeInfo.height*e,o=this.sizeInfo.cellWidth/6*e,s=this.sizeInfo.cellWidth*e;t.clear(),t.lineStyle(0),t.beginFill(11184810),t.drawRect(-2e4,0,2e4,r),t.drawRect(-2e4,-2e4,2e4+i+2e4,2e4),t.drawRect(i,0,2e4,r),t.drawRect(-2e4,r,2e4+i+2e4,2e4),t.endFill(),t.lineStyle(this.drawInfo.miniGridLineSize,this.drawInfo.miniGridLineColor);for(var a=0;a<=i;a+=o)t.moveTo(a,0),t.lineTo(a,r);for(var n=0;n<=i;n+=o)t.moveTo(0,n),t.lineTo(i,n);t.lineStyle(this.drawInfo.lineSize,this.drawInfo.lineColor);for(var a=0;a<=i;a+=s)t.moveTo(a,0),t.lineTo(a,r);for(var n=0;n<=i;n+=s)t.moveTo(0,n),t.lineTo(i,n);t.lineStyle(this.drawInfo.borderSize,this.drawInfo.borderColor),t.moveTo(0,0),t.lineTo(0,r),t.lineTo(i,r),t.lineTo(i,0),t.lineTo(0,0)},t}();e.GridDraw=i},function(t,e){"use strict";var i=function(){
    function t(t,e){this.sizeInfo=t,this.drawInfo=e}return t.prototype.render=function(t,e){var i=this.sizeInfo.width*e,r=this.sizeInfo.height*e,o=(this.sizeInfo.cellWidth/6*e,this.sizeInfo.cellWidth*e);t.clear(),t.lineStyle(0),t.beginFill(4486946),t.drawRect(-2e4,0,2e4,r),t.drawRect(-2e4,-2e4,2e4+i+2e4,2e4),t.drawRect(i,0,2e4,r),t.drawRect(-2e4,r,2e4+i+2e4,2e4),t.endFill(),t.beginFill(7640127),t.drawRect(o/2,0,o/2,r),t.drawRect(o/2+o,0,o/2,r),t.drawRect(o/2+2*o,0,o/2,r),t.drawRect(o/2+3*o,0,o/2,r),t.drawRect(o/2+4*o,0,o/2,r),t.endFill(),t.beginFill(16755200),t.drawRect(-o/2,r/3,o/2,o),t.endFill(),t.beginFill(1662975),t.drawRect(i,r/3,o/2,o),t.endFill(),t.lineStyle(12,14548957),t.drawCircle(i/2,r/2,o/2),t.moveTo(i/2,0),t.lineTo(i/2,r),t.moveTo(0,r/6),t.lineTo(o,r/6),t.lineTo(o,r-r/6),t.lineTo(0,r-r/6),t.moveTo(0,r/3-o/10),t.lineTo(o/2,r/3-o/10),t.lineTo(o/2,r-r/3+o/10),t.lineTo(0,r-r/3+o/10),t.moveTo(0,r/3),t.lineTo(-o/2,r/3),t.lineTo(-o/2,r-r/3),t.lineTo(0,r-r/3),t.moveTo(o,r/2),t.arc(o-o/4,r/2,o/2,Math.PI/3,-Math.PI/3,!0),t.moveTo(i,r/6),t.lineTo(i-o,r/6),t.lineTo(i-o,r-r/6),t.lineTo(i,r-r/6),t.moveTo(i,r/3-o/10),t.lineTo(i-o/2,r/3-o/10),t.lineTo(i-o/2,r-r/3+o/10),t.lineTo(i,r-r/3+o/10),t.moveTo(i,r/3),t.lineTo(i+o/2,r/3),t.lineTo(i+o/2,r-r/3),t.lineTo(i,r-r/3),t.moveTo(i-o,r/2),t.arc(i-(o-o/4),r/2,o/2,2*Math.PI/3,-2*Math.PI/3,!1),t.lineStyle(20,14548957),t.moveTo(0,0),t.lineTo(0,r),t.lineTo(i,r),t.lineTo(i,0),t.lineTo(0,0)},t}();e.FieldDraw=i},function(t,e){"use strict";var i=function(){function t(t){this.defaultRopeTexture=t,this.sprites=new Array,this.ropes={},this.texts=new Array,this.containers=new Array,this.points=new Array,this.pointsArr={},this.numbersArr={},this.float32Arr={},this.uint16Arr={}}return t.prototype.popSprite=function(){return 0==this.sprites.length?new PIXI.Sprite:this.sprites.pop()},t.prototype.pushSprite=function(t){t.tint=16777215,this.sprites.push(t)},t.prototype.popRope=function(t){var e,i=this.ropes;if(i[t]&&0!=i[t].length)e=i[t].pop(),e.points=this.popPoints(t);else{var r=this.popPoints(t);e=new PIXI.mesh.Rope(this.defaultRopeTexture,r)}return e},t.prototype.popPoint=function(t,e){var i;return i=0==this.points.length?new PIXI.Point:this.points.pop(),i.set(t,e),i},t.prototype.pushPoint=function(t){this.points.push(t)},t.prototype.popPoints=function(t){if(!this.pointsArr[t]||0==this.pointsArr[t].length){for(var e=new Array(t),i=0;i<e.length;++i)e[i]=new PIXI.Point;return e}return this.pointsArr[t].pop()},t.prototype.pushPoints=function(t){this.pointsArr[t.length]||(this.pointsArr[t.length]=new Array),this.pointsArr[t.length].push(t)},t.prototype.popNumbers=function(t){return this.numbersArr[t]&&0!=this.numbersArr[t].length?this.numbersArr[t].pop():new Array(t)},t.prototype.pushUint16Arr=function(t){this.uint16Arr[t.length]||(this.uint16Arr[t.length]=new Array),this.uint16Arr[t.length].push(t)},t.prototype.popUint16Arr=function(t){return this.uint16Arr[t]&&0!=this.uint16Arr[t].length?this.uint16Arr[t].pop():new Uint16Array(t)},t.prototype.pushFloat32Arr=function(t){this.float32Arr[t.length]||(this.float32Arr[t.length]=new Array),this.float32Arr[t.length].push(t)},t.prototype.popFloat32Arr=function(t){return this.float32Arr[t]&&0!=this.float32Arr[t].length?this.float32Arr[t].pop():new Float32Array(t)},t.prototype.pushNumbers=function(t){this.numbersArr[t.length]||(this.numbersArr[t.length]=new Array),this.numbersArr[t.length].push(t)},t.prototype.pushRope=function(t){this.ropes[t.points.length]||(this.ropes[t.points.length]=new Array),this.ropes[t.points.length].push(t),this.pushPoints(t.points),t.points=void 0},t.prototype.popContainer=function(){return 0==this.containers.length?new PIXI.Container:this.containers.pop()},t.prototype.pushContainer=function(t){this.containers.push(t)},t.prototype.pushText=function(t){this.texts.push(t)},t.prototype.popText=function(){return 0==this.texts.length?new PIXI.Text("",{font:'bold 30px Helvetica, Arial, "Microsoft Yahei", STXihei, sans-serif',fill:"white",dropShadow:!0,strokeThickness:1,align:"center"}):this.texts.pop()},t.prototype.recycleElement=function(t){if(t){if(t.setTransform(0,0,1,1,0),t.anchor&&t.anchor.set(0,0),t.tint&&(t.tint=16777215),t.alpha&&(t.alpha=1),t.mask&&(t.mask=void 0),t.scale&&t.scale.set(1,1),t.children){for(var e=0,i=t.children;e<i.length;e++){var r=i[e];this.recycleElement(r)}t.removeChildren()}t.parent&&t.parent.removeChild(t),t instanceof PIXI.mesh.Rope?this.pushRope(t):t instanceof PIXI.Text?this.pushText(t):t instanceof PIXI.Sprite&&this.pushSprite(t)}},t}();e.RenderFactory=i},function(t,e){"use strict";var i=function(){function t(){this.stage=new PIXI.Container,this.world2d=new PIXI.Container,this.worldElemFullScreenCoverAbove=new PIXI.Container,this.worldElemFullScreenCover=new PIXI.Container,this.worldElemVeryTopMost=new PIXI.Container,this.worldElemTopMostAbove=new PIXI.Container,this.worldElemTopMost=new PIXI.Container,this.worldElemTopAbove=new PIXI.Container,this.worldElemTop=new PIXI.Container,this.worldElemMid=new PIXI.Container,this.worldElemBack=new PIXI.Container,this.worldElemBackMost=new PIXI.Container,this.worldDraw=new PIXI.Graphics,this.gridDraw=new PIXI.Graphics,this.stage.addChild(this.gridDraw),this.stage.addChild(this.world2d),this.world2d.addChild(this.worldElemBackMost),this.world2d.addChild(this.worldElemBack),this.world2d.addChild(this.worldElemMid),this.world2d.addChild(this.worldElemTop),this.world2d.addChild(this.worldElemTopAbove),this.world2d.addChild(this.worldElemTopMost),this.world2d.addChild(this.worldElemTopMostAbove),this.world2d.addChild(this.worldElemVeryTopMost),this.world2d.addChild(this.worldDraw),this.world2d.addChild(this.worldElemFullScreenCover),this.world2d.addChild(this.worldElemFullScreenCoverAbove),this.uiDraw=new PIXI.Graphics,this.stage.addChild(this.uiDraw)}return t.prototype.cleanContainer=function(t,e){for(var i=0,r=e.children;i<r.length;i++){var o=r[i];t.recycleElement(o)}e.removeChildren()},t.prototype.clean=function(t){this.cleanContainer(t,this.worldElemFullScreenCoverAbove),this.cleanContainer(t,this.worldElemFullScreenCover),this.cleanContainer(t,this.worldElemVeryTopMost),this.cleanContainer(t,this.worldElemTopMostAbove),this.cleanContainer(t,this.worldElemTopMost),this.cleanContainer(t,this.worldElemTopAbove),this.cleanContainer(t,this.worldElemTop),this.cleanContainer(t,this.worldElemMid),this.cleanContainer(t,this.worldElemBack),this.cleanContainer(t,this.worldElemBackMost),this.cleanContainer(t,this.uiDraw)},t}();e.RenderLayers=i},function(t,e,i){"use strict";var r=i(9),o=i(7),s=function(){function t(){this.packets=(t={},t[r.PacketID.GetLobbies]=function(){return new o.JsonPacket(r.PacketID.GetLobbies)},t[r.PacketID.Start]=function(){return new o.StartPacket},t[r.PacketID.Ping]=function(){return new o.PingPacket},t[r.PacketID.RIP]=function(){return new o.RIPPacket},t[r.PacketID.PlayerInfo]=function(){return new o.PlayerInfoPacket},t[r.PacketID.LeaderBoard]=function(){return new o.LeaderBoardPacket},t[r.PacketID.SetElements]=function(){return new o.SetElementsPacket},t[r.PacketID.TeamInfo]=function(){return new o.TeamInfoPacket},t[r.PacketID.TransientElement]=function(){return new o.TransientElementPacket},t);var t}return t.prototype.create=function(t){return this.packets[t]()},t}();e.ConcretePacketFactory=s},function(t,e,i){"use strict";var r=i(12),o=function(){function t(t){this.renderer=t,this.skinnedTextureMap={},this.textureMap={},this.namedTextureMap={},this.setupTextures()}return t.prototype.getSkinnedTexture=function(t,e){if(0==t)return this.getTexture(e);this.skinnedTextureMap[t]||(this.skinnedTextureMap[t]={});var i=r.GetMeta(t),o=i.NoColorOverlay?-1:e;if(!this.skinnedTextureMap[t][o]){var s=void 0;if(!i.NoMask&&(s=this.getNamedTexture("narwhalemask"),s===this.placeholderTexture))return this.placeholderTexture;var a=i.Name?i.Name:"skin"+t.toString(),n=i.UseRawSkin?this.getTexture(e):this.getNamedTexture(a);if(n===this.placeholderTexture)return n;var h=void 0;if(i.CullMask&&(h=this.getNamedTexture(i.CullMask),h===this.placeholderTexture))return this.getTexture(e);var l=new PIXI.Container,c=void 0,d=void 0,p=void 0,u=new PIXI.Sprite(n);if(!i.NoColorOverlay){var y=this.getTexture(e);p=new PIXI.Sprite(y),p.anchor.set(.5,.5),p.setTransform(y.width/2,y.height/2,1,.95),p.setParent(l)}if(i.NoMask||(u.mask=new PIXI.Sprite(s)),i.CullMask){var m=new PIXI.Container,f=new PIXI.Sprite(h);f.scale.set(-1,-1),f.anchor.set(1,1),f.setParent(m),d=new PIXI.Sprite(m.generateTexture(this.renderer)),m.destroy(),l.mask=d}u.alpha=1,u.scale.set(-1,-1),u.anchor.set(1,1),u.setParent(l),this.skinnedTextureMap[t][o]=l.generateTexture(this.renderer),p&&p.destroy(),c&&c.destroy(),d&&d.destroy(),u&&u.destroy(),l.destroy()}return this.skinnedTextureMap[t][o]},t.prototype.getTexture=function(t){if(!this.textureMap[t]){var e=this.getNamedTexture("narwhale");if(e===this.placeholderTexture)return this.placeholderTexture;var i=new PIXI.Sprite(e);i.tint=t,this.textureMap[t]=i.generateTexture(this.renderer),i.destroy()}return this.textureMap[t]},t.prototype.getNamedTexture=function(t,e){var i=this;return this.namedTextureMap[t]||(this.namedTextureMap[t]=this.placeholderTexture,(new PIXI.loaders.Loader).add(t,"img/"+t+".png").load(function(t,r){for(var o in r)r[o].error||(i.namedTextureMap[o]=r[o].texture,e&&e(i.namedTextureMap[o]))})),this.namedTextureMap[t]},t.prototype.setupTextures=function(){var t=new PIXI.Graphics;t.beginFill(16777215),t.drawRoundedRect(0,0,10,10,2.5),t.endFill(),this.circleTexture=t.generateTexture(this.renderer),t.clear(),t.beginFill(13487565,0),t.drawRect(0,0,1,1),t.endFill(),this.placeholderTexture=t.generateTexture(this.renderer),t.clear(),t.beginFill(0,.1),t.drawCircle(3,3,4),t.drawCircle(3,43,4),t.endFill(),t.beginFill(0,.3),t.drawCircle(3,3,3.5),t.drawCircle(3,43,3.5),t.endFill(),t.beginFill(0,.9),t.drawCircle(3,3,2.8),t.drawCircle(3,43,2.8),t.endFill(),this.eyeTexture=t.generateTexture(this.renderer),t.destroy()},t}();e.TextureManager=o},function(t,e){"use strict";!function(t){t[t.SmokeExplosion=0]="SmokeExplosion"}(e.TransientObjectID||(e.TransientObjectID={}));e.TransientObjectID}]);